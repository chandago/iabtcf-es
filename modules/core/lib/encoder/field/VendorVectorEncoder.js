"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var model_1=require("../../model"),__1=require("../"),IntEncoder_1=require("./IntEncoder"),BooleanEncoder_1=require("./BooleanEncoder"),FixedVectorEncoder_1=require("./FixedVectorEncoder"),VectorEncodingType_1=require("./VectorEncodingType"),VendorVectorEncoder=function(){function e(){}return e.encode=function(e){var n,t=[],o=[],r=IntEncoder_1.IntEncoder.encode(e.maxId,__1.BitLength.maxId),d="",c=__1.BitLength.maxId+__1.BitLength.encodingType,_=c+e.maxId,i=2*__1.BitLength.vendorId+__1.BitLength.singleOrRange+__1.BitLength.numEntries,E=c+__1.BitLength.numEntries;return e.forEach((function(r,c){(d+=BooleanEncoder_1.BooleanEncoder.encode(r),(n=e.maxId>i&&E<_)&&r)&&(e.has(c+1)?0===o.length&&(o.push(c),E+=__1.BitLength.singleOrRange,E+=__1.BitLength.vendorId):(o.push(c),E+=__1.BitLength.vendorId,t.push(o),o=[]))})),n?(r+=VectorEncodingType_1.VectorEncodingType.RANGE+"",r+=this.buildRangeEncoding(t)):(r+=VectorEncodingType_1.VectorEncodingType.FIELD+"",r+=d),r},e.decode=function(e){var n,t=0,o=IntEncoder_1.IntEncoder.decode(e.substr(t,__1.BitLength.maxId),__1.BitLength.maxId);t+=__1.BitLength.maxId;var r=IntEncoder_1.IntEncoder.decode(e.charAt(t),__1.BitLength.encodingType);if(t+=__1.BitLength.encodingType,r===VectorEncodingType_1.VectorEncodingType.RANGE){n=new model_1.Vector;var d=IntEncoder_1.IntEncoder.decode(e.substr(t,__1.BitLength.numEntries),__1.BitLength.numEntries);t+=__1.BitLength.numEntries;for(var c=0;c<d;c++){var _=BooleanEncoder_1.BooleanEncoder.decode(e.charAt(t));t+=__1.BitLength.singleOrRange;var i=IntEncoder_1.IntEncoder.decode(e.substr(t,__1.BitLength.vendorId),__1.BitLength.vendorId);if(t+=__1.BitLength.vendorId,_){var E=IntEncoder_1.IntEncoder.decode(e.substr(t,__1.BitLength.vendorId),__1.BitLength.vendorId);t+=__1.BitLength.vendorId;for(var g=i;g<=E;g++)n.set(g)}else n.set(i)}}else{var h=e.substr(t,o);t+=o,n=FixedVectorEncoder_1.FixedVectorEncoder.decode(h,o)}return n.bitLength=t,n},e.buildRangeEncoding=function(e){var n=e.length,t=IntEncoder_1.IntEncoder.encode(n,__1.BitLength.numEntries);return e.forEach((function(e){var n=1===e.length;t+=BooleanEncoder_1.BooleanEncoder.encode(!n),t+=IntEncoder_1.IntEncoder.encode(e[0],__1.BitLength.vendorId),n||(t+=IntEncoder_1.IntEncoder.encode(e[1],__1.BitLength.vendorId))})),t},e}();exports.VendorVectorEncoder=VendorVectorEncoder;